{% extends 'base.html' %}

{% block title %}My Claims Â· Wishlist App{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4">
    <div>
        <h1 class="h3 mb-1">My Claims</h1>
        <p class="text-muted mb-0">Items you've claimed or purchased for others.</p>
    </div>
    <div class="mt-3 mt-md-0">
        <a href="{{ url_for('items.items_list') }}" class="btn btn-outline-primary btn-sm">Back to All Items</a>
    </div>
</div>

{% if claimed_count > 0 or purchased_count > 0 or contributions %}
<div class="glass-card mb-4 p-4 fade-in-delay-1">
    <h2 class="h6 fw-bold mb-3 border-bottom border-light-subtle pb-2">Summary</h2>
    <div class="row text-center">
        <div class="col-{% if contributions %}4{% else %}6{% endif %} border-end border-light-subtle">
            <div class="h3 mb-0 text-warning">{{ claimed_count }}</div>
            <small class="text-muted">Claimed</small>
        </div>
        {% if contributions %}
        <div class="col-4 border-end border-light-subtle">
            <div class="h3 mb-0 text-primary">{{ contributions|length }}</div>
            <small class="text-muted">Split Gifts</small>
        </div>
        {% endif %}
        <div class="col-{% if contributions %}4{% else %}6{% endif %}">
            <div class="h3 mb-0 text-success">{{ purchased_count }}</div>
            <small class="text-muted">Purchased</small>
        </div>
    </div>
</div>
{% endif %}

{% if grouped_items %}
<div class="masonry-grid-container">
    {% for group in grouped_items %}
    <div class="mb-5 fade-in-delay-2">
        <div class="d-flex align-items-center mb-3 px-2">
            <h2 class="h4 mb-0 fw-bold">For {{ group.user.name }}</h2>
            <span class="badge bg-light text-dark ms-3 border">{{ group.items|length }} item{{ 's' if group.items|length
                != 1 else '' }}</span>
        </div>
        <div class="row g-4">
            {% for item in group.items %}
            {% include 'partials/_item_card.html' %}
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if contributions %}
<div class="mb-5 fade-in-delay-3">
    <h2 class="h4 mb-3 fw-bold">Split Contributions</h2>
    <div class="row g-4">
        {% for contrib in contributions %}
        {% set item = contrib.item %}
        {% include 'partials/_item_card.html' %}
        {% endfor %}
    </div>
</div>
{% endif %}

{% if not grouped_items and not contributions %}
<div class="glass-card text-center p-5 fade-in-up">
    <div class="mb-3 text-muted opacity-50">
        <i class="bi bi-gift" style="font-size: 3rem;"></i>
    </div>
    <h2 class="h4 fw-bold mb-2">No claimed items yet</h2>
    <p class="text-muted mb-4">When you claim items for others, they'll appear here so you can track them.</p>
    <a class="btn btn-primary shadow-sm px-4 rounded-pill" href="{{ url_for('items.items_list') }}">
        Browse Wishlists
    </a>
</div>
{% endif %}
{% endblock %}