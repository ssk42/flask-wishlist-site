{% extends 'base.html' %}

{% block content %}
{% if current_user.is_authenticated %}
<div class="dashboard-container fade-in-delay-1">
    <!-- Dashboard Header -->
    <div class="d-flex align-items-center justify-content-between mb-4">
        <div>
            <h1 class="h3 fw-bold mb-1">Welcome back, {{ current_user.name }}!</h1>
            <p class="text-muted mb-0">Here's what's happening in your family wishlist.</p>
        </div>
        <a href="{{ url_for('items.submit_item') }}" class="btn btn-primary d-none d-md-inline-flex align-items-center">
            <i class="bi bi-plus-lg me-2"></i> Add Item
        </a>
    </div>

    <!-- Quick Stats Row -->
    {% if dashboard_data %}
    <div class="row g-3 mb-5">
        <div class="col-6 col-md-3 stat-cascade">
            <div class="glass-card p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-muted small text-uppercase fw-bold">Claimed</div>
                    <div class="h2 mb-0 fw-bold text-warning">{{ dashboard_data.claimed_count }}</div>
                </div>
                <div class="bg-warning bg-opacity-10 text-warning p-2 rounded-circle">
                    <i class="bi bi-gift fs-4"></i>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3 stat-cascade">
            <div class="glass-card p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-muted small text-uppercase fw-bold">Purchased</div>
                    <div class="h2 mb-0 fw-bold text-success">{{ dashboard_data.purchased_count }}</div>
                </div>
                <div class="bg-success bg-opacity-10 text-success p-2 rounded-circle">
                    <i class="bi bi-bag-check fs-4"></i>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6">
            <!-- Action Buttons for Mobile/Tablet -->
            <div class="d-flex gap-2 h-100">
                <a href="{{ url_for('items.items_list') }}"
                    class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center">
                    <i class="bi bi-list-ul me-2"></i> View All Items
                </a>
                <a href="{{ url_for('items.submit_item') }}"
                    class="btn btn-primary w-100 d-flex align-items-center justify-content-center d-md-none">
                    <i class="bi bi-plus-lg me-2"></i> Add Item
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row g-4">
        <!-- Main Feed: Recently Added -->
        <div class="col-lg-8">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <h2 class="h5 fw-bold mb-0">Recently Added Wishes</h2>
                <a href="{{ url_for('items.items_list') }}" class="text-decoration-none small fw-bold">View All <i
                        class="bi bi-arrow-right"></i></a>
            </div>

            {% if recent_items %}
            <div class="row g-3">
                {% for item in recent_items %}
                <div class="col-md-6">
                    {% include 'partials/_dashboard_item_card.html' %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="glass-card p-5 text-center text-muted">
                <p>No recent items found.</p>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar: Upcoming Events -->
        <div class="col-lg-4">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <h2 class="h5 fw-bold mb-0">Upcoming Events</h2>
                <a href="{{ url_for('events.events_list') }}" class="text-decoration-none small fw-bold">Calendar <i
                        class="bi bi-arrow-right"></i></a>
            </div>

            {% if upcoming_events %}
            <div class="d-flex flex-column gap-3">
                {% for event in upcoming_events %}
                <div class="glass-card p-3">
                    <div class="d-flex align-items-center gap-3">
                        <div class="date-badge text-center" style="min-width: 60px; padding: 0.25rem;">
                            <span class="d-block small text-uppercase">{{ event.date.strftime('%b') }}</span>
                            <span class="d-block h5 mb-0 fw-bold">{{ event.date.strftime('%d') }}</span>
                        </div>
                        <div>
                            <h4 class="h6 fw-bold mb-0">{{ event.name }}</h4>
                            <small class="text-muted">{{ (event.date - today).days }} days away</small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="glass-card p-4 text-center text-muted">
                <p class="mb-0">No upcoming events.</p>
                <a href="{{ url_for('events.new_event') }}" class="btn btn-sm btn-outline-primary mt-2">Add Event</a>
            </div>
            {% endif %}
        </div>
    </div>



</div>
{% else %}
<!-- Guest Marketing View -->
<div class="hero-glass text-center mb-5">
    <h1 class="display-3 fw-bold mb-3 gradient-text hero-entrance">Welcome to the Family Wishlist!</h1>
    <p class="lead text-muted mb-4 mx-auto hero-entrance-delayed" style="max-width: 600px;">A place where family members can share their
        wishlists, making gift-giving easier and more meaningful.</p>

    <div class="d-flex flex-column flex-md-row gap-3 justify-content-center hero-entrance-delayed" style="animation-delay: 0.4s;">
        <a class="btn btn-primary btn-lg px-5 py-3 shadow-lg animate-pop" style="animation-delay: 0.5s;" href="{{ url_for('auth.login') }}" role="button">
            Login to View Wishlists
        </a>
        <a class="btn btn-outline-primary btn-lg px-5 py-3 animate-pop" style="animation-delay: 0.6s;" href="{{ url_for('auth.register') }}" role="button">
            Create Account
        </a>
    </div>
</div>

<div class="row g-4 mb-5">
    <div class="col-md-4">
        <div class="glass-card h-100 p-4 text-center stagger-item" style="--stagger-index: 0;">
            <div class="feature-icon mb-3">
                <i class="bi bi-gift fs-1"></i>
            </div>
            <h3 class="h5 fw-bold mb-3">Share Wishlists</h3>
            <p class="text-muted mb-0">Create and share your wishlist with family members so they know exactly what you
                want.</p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="glass-card h-100 p-4 text-center stagger-item" style="--stagger-index: 1;">
            <div class="feature-icon mb-3">
                <i class="bi bi-stars fs-1"></i>
            </div>
            <h3 class="h5 fw-bold mb-3">Surprise Protection</h3>
            <p class="text-muted mb-0">Claim items privatelyâ€”gift receivers won't see who claimed their wishes.</p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="glass-card h-100 p-4 text-center stagger-item" style="--stagger-index: 2;">
            <div class="feature-icon mb-3">
                <i class="bi bi-bullseye fs-1"></i>
            </div>
            <h3 class="h5 fw-bold mb-3">Easy Organization</h3>
            <p class="text-muted mb-0">Filter by person, priority, and status to find the perfect gift quickly.</p>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}