{% extends 'base.html' %}

{% block title %}Edit Item Â· Wishlist App{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <h1 class="h3 mb-3">Edit item</h1>
        <p class="text-muted mb-4">Make updates and keep everyone in the loop.</p>
        <form action="{{ url_for('edit_item', item_id=item.id) }}" method="post" class="bg-white border rounded shadow-sm p-4">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            {% if item.user_id == current_user.id %}
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="description" class="form-label">Description</label>
                        <input type="text" class="form-control" id="description" name="description" maxlength="750" required value="{{ item.description }}">
                    </div>
                    <div class="col-md-6">
                        <label for="link" class="form-label">Link</label>
                        <input type="url" class="form-control" id="link" name="link" value="{{ item.link }}">
                    </div>
                </div>

                <div class="row g-3 mt-2">
                    <div class="col-md-3">
                        <label for="price" class="form-label">Price</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" value="{{ item.price }}">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="priority" class="form-label">Priority</label>
                        <select class="form-select" id="priority" name="priority">
                            {% for priority in priority_choices %}
                                <option value="{{ priority }}" {% if item.priority == priority %}selected{% endif %}>{{ priority }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="category" class="form-label">Category</label>
                        <input type="text" class="form-control" id="category" name="category" value="{{ item.category }}">
                    </div>
                    <div class="col-md-3">
                        <label for="image_url" class="form-label">Image URL</label>
                        <input type="url" class="form-control" id="image_url" name="image_url" value="{{ item.image_url }}">
                    </div>
                </div>

                {% if events %}
                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <label for="event_id" class="form-label">Event (optional)</label>
                        <select id="event_id" name="event_id" class="form-select">
                            <option value="">No event</option>
                            {% for event in events %}
                                <option value="{{ event.id }}" {% if item.event_id == event.id %}selected{% endif %}>
                                    {{ event.name }} ({{ event.date.strftime('%b %d, %Y') }})
                                </option>
                            {% endfor %}
                        </select>
                        <small class="form-text text-muted">Associate this item with an upcoming event.</small>
                    </div>
                </div>
                {% endif %}
            {% else %}
                <div class="alert alert-info">
                    You're updating <strong>{{ item.user.name }}'s</strong> item. Feel free to change the status once you've purchased or delivered it.
                </div>
            {% endif %}

            {% if item.user_id != current_user.id %}
                <div class="mt-3">
                    <label for="status" class="form-label">Status</label>
                    <select class="form-select" id="status" name="status">
                        {% for status in status_choices %}
                            <option value="{{ status }}" {% if item.status == status %}selected{% endif %}>{{ status }}</option>
                        {% endfor %}
                    </select>
                </div>
            {% endif %}

            <div class="d-flex justify-content-end mt-4 gap-2">
                <a href="{{ url_for('items') }}" class="btn btn-outline-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">Save changes</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
