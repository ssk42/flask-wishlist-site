{% extends 'base.html' %}

{% block title %}Events Â· Wishlist App{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4">
    <div>
        <h1 class="h3 mb-1 fw-bold">Events</h1>
        <p class="text-muted mb-0">Organize gifts around special occasions like birthdays and holidays.</p>
    </div>
    <div class="mt-3 mt-md-0">
        <a href="{{ url_for('events.new_event') }}" class="btn btn-primary d-inline-flex align-items-center">
            <i class="bi bi-plus-circle me-2"></i>
            New Event
        </a>
    </div>
</div>

{% if upcoming_events %}
<section class="mb-5">
    <h2 class="h4 mb-3 fw-bold">Upcoming Events</h2>
    <div class="row g-4">
        {% for event in upcoming_events %}
        <div class="col-md-6 col-lg-4">
            <div class="glass-card h-100 p-0 overflow-hidden d-flex flex-column">
                <div class="p-4 flex-grow-1">
                    <div class="d-flex justify-content-between mb-3">
                        <div class="date-badge">
                            <span class="month">{{ event.date.strftime('%b') }}</span>
                            <span class="day">{{ event.date.strftime('%d') }}</span>
                        </div>
                        <div>
                            <span
                                class="badge bg-primary-subtle text-primary border border-primary-subtle rounded-pill">Upcoming</span>
                            {% if event.items %}
                            <span
                                class="badge bg-secondary-subtle text-secondary border border-secondary-subtle rounded-pill ms-1">{{
                                event.items|length }} items</span>
                            {% endif %}
                        </div>
                    </div>

                    <h3 class="h4 fw-bold mb-2">{{ event.name }}</h3>
                    <p class="text-muted mb-0 small">
                        <span class="d-block mb-1"><i class="bi bi-calendar-event me-1"></i> {{ event.date.strftime('%A,
                            %Y') }}</span>
                        <span>Created by {{ event.created_by.name }}</span>
                    </p>
                </div>

                {% if event.created_by_id == current_user.id %}
                <div class="card-footer bg-transparent border-top border-light-subtle p-3">
                    <div class="d-flex gap-2">
                        <a href="{{ url_for('events.edit_event', event_id=event.id) }}"
                            class="btn btn-sm btn-outline-primary flex-grow-1">Edit</a>
                        <form action="{{ url_for('events.delete_event', event_id=event.id) }}" method="post"
                            class="d-inline flex-grow-1">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                            <button type="submit" class="btn btn-sm btn-outline-danger w-100"
                                onclick="return confirm('Are you sure you want to delete this event?');">Delete</button>
                        </form>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

{% if past_events %}
<section class="mb-5">
    <h2 class="h4 mb-3 text-muted">Past Events</h2>
    <div class="row g-4">
        {% for event in past_events %}
        <div class="col-md-6 col-lg-4">
            <div class="glass-card h-100 p-0 overflow-hidden d-flex flex-column" style="opacity: 0.7;">
                <div class="p-4 flex-grow-1">
                    <div class="d-flex justify-content-between mb-3">
                        <div class="date-badge opacity-50">
                            <span class="month">{{ event.date.strftime('%b') }}</span>
                            <span class="day">{{ event.date.strftime('%d') }}</span>
                        </div>
                        <div>
                            <span
                                class="badge bg-secondary-subtle text-secondary border border-secondary-subtle rounded-pill">Past</span>
                            {% if event.items %}
                            <span
                                class="badge bg-secondary-subtle text-secondary border border-secondary-subtle rounded-pill ms-1">{{
                                event.items|length }} items</span>
                            {% endif %}
                        </div>
                    </div>

                    <h3 class="h5 fw-bold mb-2 text-muted">{{ event.name }}</h3>
                    <p class="text-muted mb-0 small">
                        <span class="d-block mb-1"><i class="bi bi-calendar-event me-1"></i> {{ event.date.strftime('%A,
                            %Y') }}</span>
                        <span>Created by {{ event.created_by.name }}</span>
                    </p>
                </div>

                {% if event.created_by_id == current_user.id %}
                <div class="card-footer bg-transparent border-top border-light-subtle p-3">
                    <div class="d-flex gap-2">
                        <a href="{{ url_for('events.edit_event', event_id=event.id) }}"
                            class="btn btn-sm btn-outline-secondary flex-grow-1">Edit</a>
                        <form action="{{ url_for('events.delete_event', event_id=event.id) }}" method="post"
                            class="d-inline flex-grow-1">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                            <button type="submit" class="btn btn-sm btn-outline-danger w-100"
                                onclick="return confirm('Are you sure you want to delete this event?');">Delete</button>
                        </form>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

{% if not upcoming_events and not past_events %}
<div class="glass-card p-5 text-center fade-in-delay-1" style="max-width: 600px; margin: 0 auto;">
    <div class="mb-4 text-muted" style="opacity: 0.5;">
        <i class="bi bi-calendar-plus fs-1"></i>
    </div>
    <h2 class="h4 mb-2 fw-bold">No events yet</h2>
    <p class="text-muted mb-4">Create events to organize gifts around special occasions.</p>
    <a class="btn btn-primary" href="{{ url_for('events.new_event') }}">
        <i class="bi bi-plus-circle me-2"></i>
        Create your first event
    </a>
</div>
{% endif %}
{% endblock %}